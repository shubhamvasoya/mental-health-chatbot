<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulCare - Your Mental Health Companion</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Welcome Screen (shows initially) -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-content">
            <div class="welcome-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="welcome-title">Welcome to SoulCare</h1>
            <p class="welcome-subtitle">Your compassionate AI companion for mental wellness</p>
            <p class="welcome-description">
                I'm here to listen, support, and guide you through your mental health journey. 
                Feel free to share what's on your mind - this is a safe, judgment-free space.
            </p>
            <button class="btn-start" onclick="startChat()">
                <i class="fas fa-comment-dots"></i> Start Conversation
            </button>
            <div class="welcome-features">
                <div class="feature-item">
                    <i class="fas fa-lock"></i>
                    <span>Private & Secure</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-clock"></i>
                    <span>24/7 Available</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span>Evidence-Based Support</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Chat Interface -->
    <div class="container-fluid h-100" id="chatInterface" style="display: none;">
        <div class="row justify-content-center h-100">
            <div class="col-12 col-md-10 col-lg-8 col-xl-6 chat">
                <div class="card">
                    <!-- Chat Header -->
                    <div class="card-header msg_head">
                        <div class="d-flex align-items-center">
                            <div class="img_cont">
                                <div class="avatar-bot">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <span class="online_icon"></span>
                            </div>
                            <div class="user_info">
                                <span class="bot-name">SoulCare AI</span>
                                <p class="bot-status">Here to support you</p>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button class="action-btn" onclick="clearChat()" title="Clear conversation">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="action-btn" id="action_menu_btn" title="Menu">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                        <div class="action_menu">
                            <ul>
                                <li onclick="toggleTheme()"><i class="fas fa-palette"></i> Change Theme</li>
                                <li onclick="showInfo()"><i class="fas fa-info-circle"></i> About SoulCare</li>
                                <li onclick="exportChat()"><i class="fas fa-download"></i> Export Conversation</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Chat Messages Area -->
                    <div class="card-body msg_card_body" id="messageFormeight">
                        <!-- Initial Bot Message -->
                        <div class="d-flex justify-content-start mb-4 message-appear">
                            <div class="img_cont_msg">
                                <div class="avatar-bot-msg">
                                    <i class="fas fa-brain"></i>
                                </div>
                            </div>
                            <div class="msg_cotainer">
                                Hello! I'm SoulCare, your mental health companion. ðŸ˜Š
                                <span class="msg_time">Just now</span>
                            </div>
                        </div>
                        <div class="d-flex justify-content-start mb-4 message-appear">
                            <div class="img_cont_msg">
                                <div class="avatar-bot-msg">
                                    <i class="fas fa-brain"></i>
                                </div>
                            </div>
                            <div class="msg_cotainer">
                                How are you feeling today? You can share anything that's on your mind.
                                <span class="msg_time">Just now</span>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div id="typingIndicator" class="typing-indicator" style="display: none;">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span class="typing-text">SoulCare is typing...</span>
                    </div>

                    <!-- Quick Reply Suggestions -->
                    <div class="quick-replies" id="quickReplies">
                        <button class="quick-reply-btn" onclick="sendQuickReply('I\'m feeling anxious')">
                            ðŸ˜° Feeling anxious
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('I need stress management tips')">
                            ðŸ˜“ Stress management
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('Tell me about mindfulness')">
                            ðŸ§˜ Mindfulness
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('I want to talk about my feelings')">
                            ðŸ’­ Talk about feelings
                        </button>
                    </div>

                    <!-- Chat Input Footer -->
                    <div class="card-footer">
                        <form id="messageArea" class="input-group">
                            <textarea 
                                name="msg" 
                                class="form-control type_msg" 
                                placeholder="Share what's on your mind..." 
                                id="textInput"
                                rows="1"
                            ></textarea>
                            <div class="input-group-append">
                                <button class="input_btn send_btn" type="submit">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                        <div class="chat-footer-note">
                            <i class="fas fa-shield-alt"></i> Your conversation is private and secure
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script>
        // Start chat function
        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'block';
            document.getElementById('textInput').focus();
        }

        // Auto-resize textarea
        const textarea = document.getElementById('textInput');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Submit message on Enter (Shift+Enter for new line)
        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('messageArea').dispatchEvent(new Event('submit'));
            }
        });

        // Handle message submission
        $(document).ready(function() {
            // Action menu toggle
            $("#action_menu_btn").click(function() {
                $(".action_menu").toggle();
            });

            $("#messageArea").on("submit", function(event) {
                const rawText = $("#textInput").val().trim();
                if (!rawText) {
                    event.preventDefault();
                    return;
                }

                const userHtml = '<div class="d-flex justify-content-end mb-4 message-appear"><div class="msg_cotainer_send">' + 
                    rawText + '<span class="msg_time_send">Just now</span></div>' +
                    '<div class="img_cont_msg"><div class="avatar-user-msg"><i class="fas fa-user"></i></div></div></div>';
                
                $("#messageFormeight").append(userHtml);
                $("#textInput").val("");
                textarea.style.height = 'auto';
                
                // Scroll to bottom
                $(".msg_card_body").animate({ scrollTop: $(".msg_card_body")[0].scrollHeight }, 300);
                
                // Show typing indicator
                $("#typingIndicator").fadeIn(300);
                
                // Hide quick replies after first message
                $("#quickReplies").fadeOut(300);

                $.ajax({
                    data: { msg: rawText },
                    type: "POST",
                    url: "/get",
                }).done(function(data) {
                    $("#typingIndicator").fadeOut(200, function() {
                        const botHtml = '<div class="d-flex justify-content-start mb-4 message-appear">' +
                            '<div class="img_cont_msg"><div class="avatar-bot-msg"><i class="fas fa-brain"></i></div></div>' +
                            '<div class="msg_cotainer">' + markdownToHtml(data) + '<span class="msg_time">Just now</span></div></div>';
                        
                        $("#messageFormeight").append(botHtml);
                        $(".msg_card_body").animate({ scrollTop: $(".msg_card_body")[0].scrollHeight }, 300);
                    });
                }).fail(function() {
                    $("#typingIndicator").fadeOut(200);
                    alert("Sorry, I'm having trouble connecting. Please try again.");
                });

                event.preventDefault();
            });
        });

        // Quick reply function
        function sendQuickReply(message) {
            $("#textInput").val(message);
            $("#messageArea").submit();
        }

        // Clear chat function
        function clearChat() {
            if (confirm("Are you sure you want to clear this conversation?")) {
                $("#messageFormeight").html(`
                    <div class="d-flex justify-content-start mb-4 message-appear">
                        <div class="img_cont_msg"><div class="avatar-bot-msg"><i class="fas fa-brain"></i></div></div>
                        <div class="msg_cotainer">Hello! I'm SoulCare, your mental health companion. ðŸ˜Š<span class="msg_time">Just now</span></div>
                    </div>
                    <div class="d-flex justify-content-start mb-4 message-appear">
                        <div class="img_cont_msg"><div class="avatar-bot-msg"><i class="fas fa-brain"></i></div></div>
                        <div class="msg_cotainer">How are you feeling today? You can share anything that's on your mind.<span class="msg_time">Just now</span></div>
                    </div>
                `);
                $("#quickReplies").fadeIn(300);
            }
        }


        function markdownToHtml(markdown) {
            let html = markdown;
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');  // **bold**
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');              // *italic*
            html = html.replace(/^\s*[\*\-]\s+(.+)$/gm, '<li>$1</li>');   // bullet points
            html = html.replace(/(<li>.*?<\/li>)/s, '<ul class="response-list">$1</ul>');
            html = html.replace(/\n/g, '<br>');                             // line breaks
            return html;
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            $(".action_menu").hide();
        }

        // Show info
        function showInfo() {
            alert("SoulCare is an AI-powered mental health chatbot designed to provide compassionate support and evidence-based guidance. Remember, while I'm here to help, I'm not a replacement for professional mental health care.");
            $(".action_menu").hide();
        }

        // Export chat (placeholder)
        function exportChat() {
            alert("Chat export feature coming soon!");
            $(".action_menu").hide();
        }

        // Close action menu when clicking outside
        $(document).click(function(e) {
            if (!$(e.target).closest('#action_menu_btn, .action_menu').length) {
                $(".action_menu").hide();
            }
        });
    </script>
</body>
</html>
